# Adding Structure to AI Agent Outputs

## The Problem

Generative AI models are inconsistent and chatty. They output different responses each time, making it difficult to extract actions programmatically for autonomous agent loops.

## Core Challenge

Need to structure prompts so agents can:

- Output actions in consistent format
- Enable programmatic parsing
- Execute actions autonomously in loops

## Two Approaches

### 1. Prompt Engineering + Parsing (Bare Metal)

- Works with any LLM
- Full control over output format
- Requires manual prompt design and parsing logic

### 2. Function Calling

- Requires LLM with function calling capabilities
- Returns structured JSON responses
- Simplifies consistent output format

## Template Pattern for Structured Output

### Basic Action Template

```
Whenever I ask you to solve a problem, you can take these actions: [action_list]
You will always produce your output in this exact format:
[action]:[object]
```

**Example:**

- Actions: pick up, use, discard
- Objects: pan, butter, green bean, salt, garlic, spatula
- Output: `pickup:pan`

### Function-Style Template

```
You can take these actions:
- fetch_web_page_text(URL)
- base64_encode(value)

Output format:
[reasoning]
action
variable = action_result
```

**Example:**

```
page_text = fetch_web_page_text(https://vanderbilt.edu)
encoded_text = base64_encode(page_text)
```

### Code Execution Template

```
You can take these actions: execute Bash or Python
Output format:
[reasoning]
```bash
command
```

```

## Key Principles

1. **Give AI a reasoning placeholder** - Provides space for chattiness before action
2. **Use template patterns** - LLMs follow placeholder instructions well
3. **One action at a time** - Simplifies parsing and execution
4. **Provide feedback loop** - Return action results to AI for next iteration
5. **Build conversation memory** - Each message adds to AI's context

## Agent Loop Implementation
1. Generate prompt with action template
2. Get structured response from AI
3. Parse action from response
4. Execute action in environment
5. Return result as feedback
6. Repeat with updated conversation context

## Parsing Considerations
- Expect variations (capitalization, formatting)
- Build robust parsers for template patterns
- Include retry mechanisms for failed parses
- Use markdown blocks for code isolation
